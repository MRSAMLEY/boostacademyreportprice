<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Boost Academy Dashboard - Send Album</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet" />

<script src="https://cdn.tailwindcss.com"></script>

<style>
	body {
		font-family: 'Quicksand', 'Poppins', sans-serif;
		background: linear-gradient(120deg, #FFDEE9, #B5FFFC);
		min-height: 100vh;
		margin: 0;
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		padding: 1rem;
		box-sizing: border-box;
	}

	.container {
		background: rgba(255, 255, 255, 0.35);
		backdrop-filter: blur(20px);
		border-radius: 2rem;
		padding: 2rem;
		max-width: 720px;
		width: 100%;
		box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
	}

	h2 {
		color: #ff69b4;
		text-align: center;
		font-weight: 700;
		font-size: 2rem;
		margin-bottom: 1.5rem;
	}

	form {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	input[type="text"],
	input[type="tel"],
	input[type="number"],
	select {
		border-radius: 1.2rem;
		padding: 0.8rem 1.2rem;
		border: none;
		outline: none;
		font-size: 1.1rem;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		transition: transform 0.25s ease, box-shadow 0.25s ease;
		width: 100%;
		box-sizing: border-box;
	}

	input:focus,
	select:focus {
		transform: scale(1.03);
		box-shadow: 0 6px 20px rgba(255, 105, 180, 0.5);
	}

	#bank-buttons {
		display: flex;
		gap: 0.5rem;
		flex-wrap: wrap;
	}

	#bank-buttons button {
		background: linear-gradient(135deg, #ffb6c1, #ff69b4);
		color: white;
		font-weight: 600;
		border: none;
		padding: 0.8rem 1.2rem;
		border-radius: 2rem;
		cursor: pointer;
		box-shadow: 0 6px 20px rgba(255, 105, 180, 0.5);
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}

	#bank-buttons button.selected-bank {
		transform: scale(1.05);
		box-shadow: 0 10px 30px rgba(255, 105, 180, 0.8);
	}

	#file-drop-area {
		border: 2px dashed #ff69b4;
		border-radius: 1.5rem;
		padding: 2rem;
		text-align: center;
		color: #ff1493;
		cursor: pointer;
		user-select: none;
		transition: 0.3s ease;
	}

	#file-drop-area.dragover {
		background-color: rgba(255, 182, 193, 0.25);
	}

	#invoice-file {
		display: none;
	}

	#file-list {
		margin-top: 0.5rem;
		color: #ff69b4;
		font-size: 0.9rem;
	}

	button[type="submit"] {
		background: linear-gradient(135deg, #ffb6c1, #ff69b4);
		color: white;
		font-weight: 700;
		padding: 1rem;
		border-radius: 2rem;
		border: none;
		cursor: pointer;
		font-size: 1.2rem;
		box-shadow: 0 8px 25px rgba(255, 105, 180, 0.6);
		transition: transform 0.3s ease;
	}

	button[type="submit"]:hover:not(:disabled) {
		transform: scale(1.07);
	}

	button[type="submit"]:disabled {
		opacity: 0.6;
		cursor: not-allowed;
	}

	#message-modal {
		position: fixed;
		inset: 0;
		display: none;
		justify-content: center;
		align-items: center;
		background: rgba(0,0,0,0.3);
		z-index: 50;
	}

	.modal-content {
		background: white;
		padding: 2rem;
		border-radius: 1.5rem;
		text-align: center;
		max-width: 320px;
	}

	.modal-content h3 {
		color: #ff69b4;
		margin-bottom: 1rem;
	}

	.modal-content p {
		margin-bottom: 1.5rem;
	}

	.modal-content button {
		background: linear-gradient(135deg, #ffb6c1, #ff69b4);
		color: white;
		font-weight: 600;
		padding: 0.8rem 1.5rem;
		border-radius: 2rem;
		border: none;
		cursor: pointer;
		font-size: 1rem;
	}

	.modal-content button:hover {
		transform: scale(1.05);
	}
</style>
</head>
<body>

<div class="container">
	<h2>Boost Academy Report</h2>

	<form id="report-form" onsubmit="event.preventDefault(); sendReport()">

		<input type="text" id="name" placeholder="Customer Name" required />

		<input type="tel" id="number" placeholder="Customer Phone Number" required />

		<input type="text" id="address" placeholder="Delivery Address" required />

		<input type="text" id="delivery" placeholder="Delivery Express Service" required />

		<input type="number" id="price" placeholder="Price" required min="0" step="0.01" />

		<select id="page-name" required>
			<option value="" disabled selected>Select Source Page</option>
			<option value="Bong Pheng Store">Bong Pheng Store</option>
			<option value="Mey Smile">Mey Smile</option>
			<option value="SFI Business">SFI Business</option>
			<option value="TIK TOK">TIK TOK</option>
			<option value="Telegram">Telegram</option>
		</select>

		<select id="product" required>
			<option value="" disabled selected>Product</option>
			<option value="Charging cable ááŸ’áŸáŸ‚áŸá¶á€">Charging cable ááŸ’áŸáŸ‚áŸá¶á€</option>
			<option value="PowerBank áŠá»áŸ†áŸá¶á€ááŸ’á˜á…á›áŸá">PowerBank áŠá»áŸ†áŸá¶á€ááŸ’á˜á…á›áŸá</option>
			<option value="Headphones á€á¶áŸ">Headphones á€á¶áŸ</option>
			<option value="Speaker áŸáŸ’á–á¸á€á€áŸáš">Speaker áŸáŸ’á–á¸á€á€áŸáš</option>
			<option value="Watch á“á¶á¡á·á€á¶">Watch á“á¶á¡á·á€á¶</option>
			<option value="Cast áŸáŸ’ášáŸ„á˜á€á¶áŸ á“á·á„á‘á¼ášáŸá–áŸ’á‘áŸ">Cast áŸáŸ’ášáŸ„á˜á€á¶áŸ á“á·á„á‘á¼ášáŸá–áŸ’á‘áŸ</option>
			<option value="Keyboard, Mouse á€áŸ’áŠá¶á…á»á… á˜áŸ‰áŸ… á‘áŸ’ášá“á¶á”áŸ‹á˜áŸ‰áŸ…">Keyboard, Mouse á€áŸ’áŠá¶á…á»á… á˜áŸ‰áŸ… á‘áŸ’ášá“á¶á”áŸ‹á˜áŸ‰áŸ…</option>
			<option value="Projector á”áŸ’ášá¼á‡á¸á€á‘áŸáš">Projector á”áŸ’ášá¼á‡á¸á€á‘áŸáš</option>
			<option value="Game á˜áŸ‰á¶áŸáŸŠá¸á“Game">Game á˜áŸ‰á¶áŸáŸŠá¸á“Game</option>
			<option value="Other á•áŸ’áŸáŸá„áŸ—á‘áŸ€á">Other á•áŸ’áŸáŸá„áŸ—á‘áŸ€á</option>
		</select>

		<div class="payment-channel">Payment Channel</div>
		<div id="bank-buttons"></div>

		<div id="file-drop-area">
			Drag & Drop Invoice Images Here or Click (Multiple allowed)
			<input type="file" id="invoice-file" accept="image/*" multiple />
		</div>

		<div id="file-list" aria-live="polite" aria-atomic="true"></div>

		<button type="submit" id="submit-btn">Submit Report ğŸ’Œ</button>
	</form>
</div>

<div id="message-modal">
	<div class="modal-content">
		<h3 id="modal-title"></h3>
		<p id="modal-message"></p>
		<button onclick="hideModal()">Close âœ¨</button>
	</div>
</div>

<script>
/* IMPORTANT: The code to populate the old 'select-id' is REMOVED.
   The product select is now directly in the HTML. */

/* Payment buttons */
const bankButtonsContainer = document.getElementById("bank-buttons");
const banks = ["ABA Bank", "ACLEDA Bank", "WING Bank", "TRUE Money"];
let selectedBank = null;

banks.forEach(bank => {
	const btn = document.createElement("button");
	btn.type = "button";
	btn.textContent = bank;

	btn.addEventListener("click", () => {
		selectedBank = bank;
		[...bankButtonsContainer.children].forEach(b => b.classList.remove("selected-bank"));
		btn.classList.add("selected-bank");
	});

	bankButtonsContainer.appendChild(btn);
});

/* File Upload Handling for MULTIPLE images */
const fileDropArea = document.getElementById("file-drop-area");
const fileInput = document.getElementById("invoice-file");
const fileListDisplay = document.getElementById("file-list");

let selectedFiles = []; // Array of File objects

function updateFileListDisplay() {
	if (selectedFiles.length === 0) {
		fileListDisplay.textContent = "";
		return;
	}
	fileListDisplay.innerHTML = selectedFiles.map(f => `<div>${f.name}</div>`).join("");
}

function handleFiles(files) {
	// Filter only images
	const imageFiles = Array.from(files).filter(f => f.type.startsWith("image/"));

	if (imageFiles.length === 0) {
		alert("No valid image files detected.");
		return;
	}

	// Append new images
	selectedFiles = selectedFiles.concat(imageFiles);

	updateFileListDisplay();

	// Update input files property via DataTransfer
	const dt = new DataTransfer();
	selectedFiles.forEach(f => dt.items.add(f));
	fileInput.files = dt.files;
}

/* Click open file dialog */
fileDropArea.addEventListener("click", () => fileInput.click());

/* File select */
fileInput.addEventListener("change", () => {
	handleFiles(fileInput.files);
});

/* Drag & Drop */
fileDropArea.addEventListener("dragover", e => {
	e.preventDefault();
	fileDropArea.classList.add("dragover");
});

fileDropArea.addEventListener("dragleave", () => {
	fileDropArea.classList.remove("dragover");
});

fileDropArea.addEventListener("drop", e => {
	e.preventDefault();
	fileDropArea.classList.remove("dragover");
	handleFiles(e.dataTransfer.files);
});

/* Modal */
function showModal(title, message) {
	document.getElementById("modal-title").textContent = title;
	document.getElementById("modal-message").textContent = message;
	document.getElementById("message-modal").style.display = "flex";
}
function hideModal() {
	document.getElementById("message-modal").style.display = "none";
}

/* Send Report to Telegram as album (media group) */
async function sendReport() {
	const name = document.getElementById("name").value.trim();
	const number = document.getElementById("number").value.trim();
	const address = document.getElementById("address").value.trim();
	const delivery = document.getElementById("delivery").value.trim();
	const price = document.getElementById("price").value.trim();
	const pageName = document.getElementById("page-name").value;
	
	// *** UPDATED: Get the value from the new 'product' select element ***
	const productValue = document.getElementById("product").value; 

	// *** UPDATED: Check for the new product value instead of selectedID ***
	if (!name || !number || !address || !delivery || !price || !pageName || !productValue || !selectedBank || selectedFiles.length === 0) {
		showModal("Error", "Please fill all fields, select a product, choose payment, and upload at least one invoice image.");
		return;
	}

	const submitBtn = document.getElementById("submit-btn");
	submitBtn.disabled = true;
	submitBtn.textContent = `Sending ${selectedFiles.length} image(s) as album... ğŸ’Œ`;

	// Compose the caption once, used only on the first media
	const caption = `
*Product:* ${productValue} 
*Page:* ${pageName}

*Customer:* ${name}
*Phone:* ${number}
*Address:* ${address}
*Delivery:* ${delivery}

*Price:* $${price}
*Payment:* ${selectedBank}

Time: ${new Date().toLocaleString()}
`;

	const BOT_TOKEN = "8343485371:AAHUzwUW9flKScXHnLvpQO_wPjopAo9nOWc"; // Replace with your token
	const CHAT_ID = "-1003388800232"; // Replace with your chat ID

	// Prepare media array for sendMediaGroup:
	const formData = new FormData();
	formData.append("chat_id", CHAT_ID);

	const mediaArray = selectedFiles.map((file, index) => {
		return {
			type: "photo",
			media: `attach://file${index}`,
			// Add caption only to the first media item
			...(index === 0 ? { caption: caption.trim(), parse_mode: "Markdown" } : {})
		};
	});

	formData.append("media", JSON.stringify(mediaArray));

	// Append each file as file0, file1, file2...
	selectedFiles.forEach((file, index) => {
		formData.append(`file${index}`, file, file.name);
	});

	try {
		const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMediaGroup`, {
			method: "POST",
			body: formData
		});

		const result = await response.json();

		if (result.ok) {
			showModal("Success", `All ${selectedFiles.length} images sent successfully as an album ğŸ’–`);
			document.getElementById("report-form").reset();
			selectedBank = null;
			selectedFiles = [];
			fileListDisplay.textContent = "";
			// Reset bank buttons visually
			[...bankButtonsContainer.children].forEach(b => b.classList.remove("selected-bank"));
			// Reset product selection to placeholder
			document.getElementById("product").value = ""; 
		} else {
			throw new Error(result.description || "Unknown error");
		}

	} catch (error) {
		showModal("Error", "Failed to send album: " + error.message);
	}

	submitBtn.disabled = false;
	submitBtn.textContent = "Submit Report ğŸ’Œ";
}
</script>

</body>
</html>
